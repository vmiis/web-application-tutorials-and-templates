VmInclude:/modules/layout/top-right-corner.html
VmInclude:/modules/layout/header.html
VmInclude:/modules/layout/content-container.html
VmInclude:/modules/layout/footer.html
<script main-layout-js>
	function F__ID(){
		//------------------------------------
		var availableTags=[]
		//------------------------------------
		var set_height=function(){
			var header_height=$('#header__ID').outerHeight(); $vm.header_height=header_height;
			var footer_height=$('#footer__ID').outerHeight();
			$vm.min_height=($(window).height()-header_height-footer_height)+'px';
			$('#content_container__ID').css({'height':$vm.min_height});
			$('#content_container__ID').css({'top':header_height+'px'})
			console.log('window:'+$(window).height()+', header:'+header_height+', footer:'+footer_height);
		}
		setTimeout(function (){	set_height();},100);	setTimeout(function (){	set_height();},2000);
		//------------------------------------
		window.onmessage=function(e){
		    if(e.data.username!=undefined && e.data.user_id!=undefined){
		        $vm.user=e.data.username;
		        $vm.user_id=e.data.user_id;
		        $VmAPI.set_token(e.data.token,e.data.api_url,e.data.username,e.data.user_id,e.data.nickname);
		        location.reload(true);
		    }
		};
		//-----------------------------------------
		var modules=$vm.app_config.modules;
		for (var property in modules) {
		   if($vm.module_list[property]==undefined){
			   	$vm.module_list[property]=modules[property];
				availableTags.push(property);
		   }
		}
		//------------------------------------
		/*
		var $image1 = $("<img>");
		$image1.on('load',(function(){ $('body').css("background", "url("+$(this).attr("src")+") no-repeat bottom center"); $('body').css("background-size", "cover");  }));
		$image1.attr("src", "__HOST__/images/background.jpg");
		*/
		//------------------------------------
		var groups=[
			'static-group-001.json',
			'dynamic-group-001.json'
		];		
		var N=groups.length;
		//------------------------------------
		for(var i=0;i<N;i++){
			var url=$vm.hosting_path+"/configurations/"+groups[i];;
			var ver=localStorage.getItem(url+"_ver");
			var txt=localStorage.getItem(url+"_txt");
			if(ver!=$vm.version || txt===null || $vm.debug===true || $vm.reload!=''){
				console.log('loading '+url+'?_='+$vm.version+$vm.reload);
				$.get(url+'?_='+$vm.version+$vm.reload,function(data){
					localStorage.setItem(url+"_txt",data);
					localStorage.setItem(url+"_ver",$vm.version);
					add_to_module_list(data);;
				},'text').fail(function() {
					alert( "The configuration file ("+url+") doesn't exist!" );
				});
			}
			else{ add_to_module_list(txt); }
			
			
			$.get(url+'?_='+$vm.version+$vm.reload,function(data){
			},'text').fail(function() {
				alert( "The configuration file ("+url+") doesn't exist!" );
			});
		}
		//------------------------------------
		var add_to_module_list=function(text){
			var config;
			try{ config=JSON.parse(text);}
			catch (e){ alert("Error in config file\n"+e); return; }
			var group=config.group;
			if(group!=undefined) group=group+"_";
			else group="";
			var modules=config.modules;
			for (var property in modules) {
			   if($vm.module_list[group+property]==undefined){
				   $vm.module_list[group+property]=modules[property];
				   availableTags.push(group+property);
			   }
			}
			N--;
			if(N==0){
				$("#vm_system_search").autocomplete({
					minLength:0,
					source: function(request, response) {
        				var results=$.ui.autocomplete.filter(availableTags, request.term);
        				response(results.slice(0, 10));
    				},		      		
		      		select: function(event,ui) {
						event.preventDefault();
						$('.navbar-collapse').collapse('hide');
			      		$vm.nav_load_module(ui.item.value);
			      	}
		    	});
		    	$("#vm_system_search").focus(function(){$("#vm_system_search").autocomplete("search","");});
				if(vm_start!=undefined){vm_start();}
			}
		}
		//------------------------------------
	}
</script>
<style main-layout-css>
	html,body{
		height:100%;
	}
	@keyframes vm_module_fadein {
		from { opacity:0; }
		to {opacity:1;}
	}
	/* overwrite bootstrap */
	/*
	.ui-datepicker-month,.ui-datepicker-year{
		color:#000;
	}
	*/
    .ui-autocomplete.ui-menu{font-size:12px}
    .ui-autocomplete li:hover{
        color:White;
        background:#96B202;
        font-weight:normal;
        outline:none;
    }
</style>
