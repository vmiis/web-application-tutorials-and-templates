<section>
<div id=toolbar__ID class="navbar navbar-default" style='margin-bottom:0px;'>
    <div class="navbar-form navbar-left">
        <button type=button class='btn btn-primary' id=this__ID>This Month</button>
        <button type=button class='btn btn-primary' id=previous__ID>Previous Month</button>
        <button type=button class='btn btn-primary' id=next__ID>Next Month</button>
        <button type=button class='btn btn-primary' id=refresh__ID>Refresh</button>
        <span id=month_year__ID />
    </div>
</div>
<section style='overflow-x:auto;white-space: nowrap;'>
    <div id=calendar__ID>
        <div class='row__ID header__ID'>
            <div class='col__ID'>Monday</div>
            <div class='col__ID'>Tuesday</div>
            <div class='col__ID'>Wednesday</div>
            <div class='col__ID'>Thursday</div>
            <div class='col__ID'>Friday</div>
            <div class='col__ID'>Saturday</div>
            <div class='col__ID'>Sunday</div>
        </div>
    </div>
</section>
<style>
    #calendar__ID{
        min-width:100%;	font-size:9pt; 	
        font-family:Verdana; 	
        border-spacing: 0px;	
        border-collapse: collapse;	
        table-layout:fixed;
    }
    #calendar__ID th{ 	width:14.285%; border: 1px solid #999; padding:0 3px; 	margin:0; 	text-align:center;	background-color:#bbb}
    #calendar__ID td{ 	border: 1px solid #999;	padding:0 3px;  margin:0; }
    #calendar__ID td ul {padding-left: 23px;}
    .time__ID{
    	margin-bottom:2px;
    	border-radius:3px;
    	box-shadow: 3px 3px 2px #888;
    }
    #calendar__ID u{
        cursor:pointer;
    }
    #calendar__ID thead tr{
        height:28px;
    }
    
    .event__ID{
	    cursor:pointer;
	    border:1px solid red;
	    white-space: pre-wrap;
	    display:inline-block;
	    margin-left:10px;
	    
	    font-size: 13px;
	    border-radius: 4px;
	    padding: 5px;
	    line-height: 24px;
	    background: #e4f2f2;
	    border: 1px solid #b5dbdc;
	    color: #009aaf;
	    text-decoration: none;	    
	    
    }
    .header__ID{
	    font-weight:bold;
	    color:#fff;
	    background-color:#4d4d58;
    }
    .row__ID{
	    width:100%;
	    /*
	    height:16.666%;
	    */
	    overflow:auto;
    }
    .col__ID{
	    float:left;
	    display:block;
	    width:14.285%;
	    border:1px solid #ccc;
	    border-bottom:1px solid #ccc;
	    /*height:100%;*/
    }
    .day__ID{
	    text-align:right;
    }
    @media(max-width: 768px){
	    .header__ID{
		    display:none;
	    }
    	.row__ID{
	    	height:auto;
    	}
	    .col__ID{
		    float: none;
		    width:100%;
		    height:auto;
	    }
	    .day__ID{
		    text-align:left;
		    display:inline-block;
		    padding-right:10px;
	    }
	    .not_this_month{
		    display:none;
	    }
	    .event_container{
			display:inline-block;
	    }
    }
</style>
</section>
<script>
function F__ID(){
	//--------------------------------------------------------
var _ref=0
var _first_day;
var _last_day;
$('#previous__ID').on('click',function(){   _ref--;	_set_ref();	_request_and_render();	})
$('#this__ID').on('click',    function(){	_ref=0; _set_ref();	_request_and_render();	})
$('#next__ID').on('click',    function(){	_ref++;	_set_ref();	_request_and_render();	})
$('#refresh__ID').on('click', function(){	_request_and_render();	})
var _request_and_render=function(){};
var _set_ref=function(){
    var d=$vm.first_day_of_current_month();
    d.setMonth(d.getMonth()+_ref);
    var s=(d.getMonth()+1)+'/'+d.getFullYear();
    $('#month_year__ID').text(s);

    var d=new Date();
    var y=d.getFullYear()
    var m=d.getMonth()+_ref;
    var d0=new Date(y,m,1,0,0,0,0);
    var e=d0.getDay(); if(e===0) e=7;
    e=e-1; //0,1,...6 --- Monday....Sunday
    var x=$vm.date_add_days(d0,-e);	    _first_day=$vm.date_to_string_dmy(x);
    var y=$vm.date_add_days(d0,-e+41);  _last_day= $vm.date_to_string_dmy(y);
}
_set_ref();
//-----------------------------------
_on_day_click_fun=function(){}
_request_and_render=function(){}
//-----------------------------------
var _get_cell_div=function(d){
      var R=undefined;
      $('#calendar__ID u').each(function(){
            var ddd=$(this).data('d');
            if(ddd!==undefined){
                  var sd=$vm.date_to_string_dmy(ddd)
                  if(sd===d){
                        R=$(this).parent().next();
                        return false;
                  }
            }
      })
      if(R!==undefined) return $(R);
      return R;
}
//-----------------------------------
var _calendar_render=function(html){
    $('#calendar__ID').html('');
    var d=new Date();
    var y=d.getFullYear()
    var m=d.getMonth()+_ref;    //_ref is a number from toolbar
    var d0=new Date(y,m,1,0,0,0,0);
    var m0=d0.getMonth();
    var e=d0.getDay(); if(e===0) e=7;
    e=e-1; //0,1,...6 --- Monday....Sunday
    var n=d0.getDate()
    var id=new Date().getTime();
    for(var i=0;i<6;i++){
          var row="<div class=row__ID>";
          for(var j=0;j<7;j++){
                var idd='A'+id+'_'+i+'_'+j
                var d=$vm.date_add_days(d0,-e+7*i+j)
                var N=d.getDate();
                var lcolor="";
                var col_class='col__ID';
                if( (i==0 && N>20) || ((i==5 || i==4) && N<15) ){ lcolor="color:#999"; col_class="'col__ID not_this_month'";}
                var N="<u id="+idd+" style=cursor:pointer>"+N+"</u>";
                row+="<div class="+col_class+"><div class=day__ID style='"+lcolor+"'>"+N+"</div><div class=event_container>"+html+"</div></div>";
          }
          row+="</div>";
          $('#calendar__ID').append(row);
          for(var j=0;j<7;j++){
                var d=$vm.date_add_days(d0,-e+7*i+j)
                var idd='A'+id+'_'+i+'_'+j
                $('#'+idd).data('d',d);
                $('#'+idd).on('click',function(){
                      _on_day_click_fun( $vm.date_to_string_dmy($(this).data('d')));
                })
          }
    }
}
//-----------------------------------
var _mlist=$vm.module_list;
var _mobj=$vm.vm['__ID'];
var _sys='';
var _config='';
var _ids='';
var _group='';
if(_mobj.op!=undefined && _mobj.op.sys!=undefined){
	_sys=_mobj.op.sys;
	if(_sys.config!=undefined){
		_config=_sys.config;
        if(_config.group!=undefined) _group=_config.group+"_";
		if(_config.module_ids!=undefined){
			_ids=_config.module_ids;
		}
	}
}
//-----------------------------------------------
	//--------------------------------------------------------
	var daily_module=_group+'daily';
	var booking_record_module=_group+'booking_record';
	var booking_record_tid	 =_mlist[booking_record_module].table_id;
	//-------------------------------------
	_on_day_click_fun=function(date){
		var this_mobj  =_mobj.op.mobj;
		var this_record=_mobj.op.record;
		var op={
			//------------------
			sys:_sys,
			mobj:this_mobj,
			record:this_record,
			//------------------
			day:date,
			//------------------
		}
		$vm.load_module_by_name(daily_module,$vm.root_layout_content_slot,op)
	}
	//--------------------------------------------------------
	_request_and_render=function(){
	    var sql="select ID,Author,Information from [TABLE-"+booking_record_tid+"] where @T1<=DT1 and DT1<=@T2 order by S1";
	    var req_data={cmd:'query_records',sql:sql,t1:_first_day,t2:_last_day};
	    $VmAPI.request({data:req_data,callback:function(res){
	        _calendar_render("");
			for(var i=0;i<res.records.length;i++){
				var id=res.records[i].ID;
				var d=res.records[i].Date;
	            cell_render(res.records[i]);
			}
	        var top1=$('#calendar__ID').offset().top;
	        $('#calendar__ID').css("min-height",$(window).height()-top1-$('#'+$vm.root_layout_footer).outerHeight());
	    }});
	}
	//--------------------------------------------------------
	var cell_render=function(record){
	    var id=record.ID;
		var time=record.Time;
	    var room=record.Room_Number;
	    var name=record.Contact_Name; if(name===undefined) name="No contact name";
		var color=record.Color;
		var author=record.Author;
	    var d=record.Date;
	    var $div=_get_cell_div(d);
	    var info="<span  style=color:"+color+">"+room+" "+name+" <br>"+record.Description+"</span><br>"+time+' '+record.Duration+" hours";
	    var event="<div class=event__ID data-author="+author+" id=event__ID"+id+">"+info+"</div>";
		$div.append(event);
		$('#event__ID'+id).on('click',function(){
			var this_mobj  =_mobj.op.mobj;
			var this_record=_mobj.op.record;
			var op={
				//------------------
				sys:_sys,
				mobj:this_mobj,
				record:this_record,
				//------------------
				sql_where:' id='+id,
				//------------------
			}
            $vm.load_module_by_name(booking_record_module,undefined,op);
		});
	}
	//--------------------------------------------------------
	$('#D__ID').on('load',function(){_request_and_render();});
	$('#D__ID').on('show',function(){_request_and_render();});
	//--------------------------------------------------------
}
</script>
<style>
    #D__ID{
        overflow: hidden;
        /*background: url("__PARTS__/image/texture.png");*/
    }
</style>
